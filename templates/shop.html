<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prize Counter - Arcade Hub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='shop.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div class="user-menu">
        <div class="user-profile-btn" style="cursor: default;"> 
            <div class="avatar-display {% if user.equipped_frame %}{{ user.equipped_frame }}{% endif %}">
                {% if user.avatar.startswith('http') %}
                    <img src="{{ user.avatar }}">
                {% elif user.avatar == 'default.png' %}
                    <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=0f172a&color=fff">
                {% else %}
                    <img src="{{ url_for('static', filename='uploads/' + user.avatar) }}">
                {% endif %}
            </div>
            <span class="username-display">{{ user.username }}</span>
        </div>
    </div>

    <div class="shop-header">
        <h1>üéÅ PRIZE COUNTER</h1>
        <div class="balance-card">
            <div class="label">YOUR TICKETS</div>
            <div class="amount" id="balanceDisplay">üéüÔ∏è {{ wallet.balance }}</div>
            <div class="sub-text">Total Earned: {{ wallet.total_earned }}</div>
        </div>
    </div>

    <div class="shop-container">
        
        <h2 class="section-title"><i class="fa-solid fa-tag"></i> TITLES</h2>
        <div class="items-grid">
            {% for key, item in items.items() if item.type == 'title' %}
            <div class="shop-item">
                <div class="item-preview title-preview">{{ item.value }}</div>
                <div class="item-info">
                    <div class="item-name">{{ item.name }}</div>
                    <div class="item-price">üéüÔ∏è {{ item.price }}</div>
                </div>
                
                <div class="action-area">
                    {% if key in owned %}
                        {% if user.equipped_title == item.value %}
                            <button class="btn-equipped" disabled>EQUIPPED</button>
                        {% else %}
                            <button class="btn-equip" onclick="equipItem('{{ key }}')">EQUIP</button>
                        {% endif %}
                    {% else %}
                        <button class="btn-buy" onclick="buyItem('{{ key }}', {{ item.price }})" {% if wallet.balance < item.price %}disabled{% endif %}>
                            BUY
                        </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            <div class="shop-item" style="border-style: dashed; opacity: 0.7;">
                <div class="item-preview title-preview" style="color: #666;">(None)</div>
                <div class="item-info">
                    <div class="item-name">No Title</div>
                    <div class="item-price">FREE</div>
                </div>
                <div class="action-area">
                    <button class="btn-equip" onclick="equipItem('unequip_title')">UNEQUIP</button>
                </div>
            </div>
        </div>

        <div style="margin: 40px 0; border-top: 1px solid rgba(255,255,255,0.1);"></div>

        {% set frame_colors = {'frame-neon-blue': '#22d3ee', 'frame-gold-glow': '#facc15', 'frame-cyber-pink': '#ec4899'} %}
        <h2 class="section-title"><i class="fa-solid fa-border-all"></i> AVATAR FRAMES</h2>
        <div class="items-grid">
            {% for key, item in items.items() if item.type == 'avatar_frame' %}
            <div class="shop-item">
                <div class="item-preview title-preview" style="border: 2px solid {{ frame_colors.get(item.value, '#94a3b8') }}; color: {{ frame_colors.get(item.value, '#94a3b8') }}; font-weight: bold;">
                    FRAME
                </div>
                <div class="item-info">
                    <div class="item-name">{{ item.name }}</div>
                    <div class="item-price">üéüÔ∏è {{ item.price }}</div>
                </div>
                
                <div class="action-area">
                    {% if key in owned %}
                        {% if user.equipped_frame == item.value %}
                            <button class="btn-equipped" disabled>EQUIPPED</button>
                        {% else %}
                            <button class="btn-equip" onclick="equipItem('{{ key }}')">EQUIP</button>
                        {% endif %}
                    {% else %}
                        <button class="btn-buy" onclick="buyItem('{{ key }}', {{ item.price }})" {% if wallet.balance < item.price %}disabled{% endif %}>
                            BUY
                        </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            <div class="shop-item" style="border-style: dashed; opacity: 0.7;">
                <div class="item-preview title-preview" style="color: #666;">(None)</div>
                <div class="item-info">
                    <div class="item-name">No Frame</div>
                    <div class="item-price">FREE</div>
                </div>
                <div class="action-area">
                    <button class="btn-equip" onclick="equipItem('unequip_frame')">UNEQUIP</button>
                </div>
            </div>
        </div>

        <div style="margin: 40px 0; border-top: 1px solid rgba(255,255,255,0.1);"></div>

        {% set effect_styles = {
            'effect-confetti': 'background: linear-gradient(135deg, #fbbf24 0%, #fb7185 50%, #38bdf8 100%); color: #0b1120; text-shadow: 0 1px 0 rgba(255,255,255,0.6);',
            'effect-matrix': 'background: radial-gradient(circle at 20% 20%, rgba(74,222,128,0.4), transparent 45%), radial-gradient(circle at 80% 60%, rgba(34,197,94,0.35), transparent 50%), #0f172a; color: #22c55e; text-shadow: 0 0 8px #22c55e;',
            'effect-nebula': 'background: radial-gradient(circle at 30% 30%, rgba(94,92,255,0.6), transparent 45%), radial-gradient(circle at 70% 60%, rgba(244,114,182,0.5), transparent 50%), #111827; color: #e0f2fe; text-shadow: 0 0 10px rgba(244,114,182,0.6);'
        } %}
        <h2 class="section-title"><i class="fa-solid fa-wand-magic-sparkles"></i> LOBBY EFFECTS</h2>
        <div class="items-grid">
            {% for key, item in items.items() if item.type == 'lobby_effect' %}
            <div class="shop-item">
                <div class="item-preview title-preview effect-preview {{ item.value }}" data-effect="{{ item.value }}" style="{{ effect_styles.get(item.value, 'background: #1f2937; color: #e5e7eb;') }}">
                    PREVIEW
                </div>
                <div class="item-info">
                    <div class="item-name">{{ item.name }}</div>
                    <div class="item-price">üéüÔ∏è {{ item.price }}</div>
                </div>
                
                <div class="action-area">
                    {% if key in owned %}
                        {% if user.equipped_effect == item.value %}
                            <button class="btn-equipped" disabled>EQUIPPED</button>
                        {% else %}
                            <button class="btn-equip" onclick="equipItem('{{ key }}')">EQUIP</button>
                        {% endif %}
                    {% else %}
                        <button class="btn-buy" onclick="buyItem('{{ key }}', {{ item.price }})" {% if wallet.balance < item.price %}disabled{% endif %}>
                            BUY
                        </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
            <div class="shop-item" style="border-style: dashed; opacity: 0.7;">
                <div class="item-preview title-preview" style="color: #666;">(None)</div>
                <div class="item-info">
                    <div class="item-name">No Effect</div>
                    <div class="item-price">FREE</div>
                </div>
                <div class="action-area">
                    <button class="btn-equip" onclick="equipItem('unequip_effect')">UNEQUIP</button>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin-top: 50px;">
            <a href="/lobby" class="btn-secondary" style="border-radius: 50px; padding: 10px 30px; text-decoration: none;">
                ‚Üê Back to Lobby
            </a>
        </div>
    </div>

    <script>
        function buyItem(itemId, price) {
            if(!confirm(`Spend ${price} Tickets to buy this item?`)) return;

            fetch('/api/buy', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ item_id: itemId })
            })
            .then(res => res.json())
            .then(data => {
                if(data.status === 'success') {
                    alert("Purchase Successful!");
                    location.reload();
                } else {
                    alert("Error: " + data.message);
                }
            });
        }

        function equipItem(itemId) {
            fetch('/api/equip', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ item_id: itemId })
            })
            .then(res => res.json())
            .then(data => {
                if(data.status === 'success') {
                    location.reload();
                } else {
                    alert("Error: " + data.message);
                }
            });
        }
    </script>
</body>
</html>