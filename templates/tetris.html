<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEON TETRIS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='tetris.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div class="user-menu">
        <div class="user-profile-btn" style="cursor: default;"> 
            <div class="avatar-display {% if user.equipped_frame %}{{ user.equipped_frame }}{% endif %}">
                {% if user.avatar.startswith('http') %}
                    <img src="{{ user.avatar }}" alt="User">
                {% elif user.avatar == 'default.png' %}
                    <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=0f172a&color=fff" alt="User Avatar">
                {% else %}
                    <img src="{{ url_for('static', filename='uploads/' + user.avatar) }}" alt="User Avatar">
                {% endif %}
            </div>
            <span class="username-display">{{ user.username }}</span>
        </div>
    </div>

    <h1 class="title">NEON TETRIS</h1>

    <div class="game-container">
        <div class="info-bar">
            <div class="score-box">SCORE: <span id="score">0</span></div>
            
            <div class="action-buttons">
                <button id="startBtn" class="btn-primary">START GAME</button>
            </div>

            <div class="score-box">LINES: <span id="lines">0</span></div>
        </div>

        <div class="game-main-area">
            <!-- Hold Panel -->
            <div class="side-panel">
                <div class="panel-title">HOLD</div>
                <div class="panel-content">
                    <canvas id="holdCanvas" width="100" height="100"></canvas>
                </div>
                <div class="combo-container" id="comboContainer" style="opacity: 0;">
                    <div class="combo-count" id="comboCount">0</div>
                    <div class="combo-label">COMBO</div>
                </div>
            </div>

            <!-- Main Game -->
            <div class="canvas-wrapper">
                <canvas id="tetris" width="240" height="400"></canvas>
                <div id="floating-text-container"></div>
            </div> 

            <!-- Next Panel -->
            <div class="side-panel">
                <div class="panel-title">NEXT</div>
                <div class="panel-content">
                    <canvas id="nextCanvas" width="100" height="100"></canvas>
                </div>
            </div>
        </div>

        <div class="controls-hint">
            <span>← → Move</span>
            <span style="margin: 0 10px; color: #555;">|</span>
            <span>↑ Rotate</span>
            <span style="margin: 0 10px; color: #555;">|</span>
            <span>↓ Drop</span>
            <span style="margin: 0 10px; color: #555;">|</span>
            <span style="color: var(--primary); font-weight: bold;">Space: Hard Drop</span>
            <span style="margin: 0 10px; color: #555;">|</span>
            <span style="color: #0DC2FF; font-weight: bold;">C: Hold</span>
        </div>
        
        <div style="margin-top: 15px;">
            <button class="btn-lobby" onclick="location.href='/lobby'">
                <i class="fa-solid fa-house"></i> Lobby
            </button>
        </div>
    </div>

    <div id="gameOverModal" class="modal hidden">
        <div class="modal-content">
            <h2>GAME OVER</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p id="uploadStatus" class="status-text">Uploading score...</p>
            <div class="modal-buttons">
                <button onclick="location.reload()">Replay</button>
                <button class="btn-secondary" onclick="location.href='/lobby'">Exit</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='tetris.js') }}"></script>
</body>
</html>