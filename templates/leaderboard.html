<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊéíË°åÊ¶ú - Arcade Hub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
    <style>
        .container {
            width: 100%;
            max-width: 800px;
            margin-top: 40px;
        }

        /* Ê®ôÁ±§ÂàáÊèõÊåâÈàï */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap; 
        }
        .tab-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid transparent;
            color: var(--text-muted);
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
        }
        .tab-btn:hover { color: white; background: rgba(255,255,255,0.1); }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
        }

        /* ÊéíË°åÊ¶úË°®Ê†ºÁæéÂåñ */
        .rank-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .rank-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(30, 41, 59, 0.6);
            margin-bottom: 10px;
            padding: 15px 25px;
            border-radius: 12px;
            border-left: 4px solid transparent;
            transition: 0.2s;
        }
        .rank-item:hover {
            transform: scale(1.02);
            background: rgba(30, 41, 59, 0.9);
        }

        /* Ââç‰∏âÂêçÁâπÊïà */
        .rank-1 { border-left-color: #fbbf24; background: linear-gradient(90deg, rgba(251, 191, 36, 0.1), transparent); }
        .rank-2 { border-left-color: #94a3b8; background: linear-gradient(90deg, rgba(148, 163, 184, 0.1), transparent); }
        .rank-3 { border-left-color: #b45309; background: linear-gradient(90deg, rgba(180, 83, 9, 0.1), transparent); }

        .rank-num { font-family: 'Orbitron'; font-size: 1.2em; width: 40px; font-weight: bold; }
        .rank-1 .rank-num { color: #fbbf24; text-shadow: 0 0 10px #fbbf24; }
        .rank-2 .rank-num { color: #e2e8f0; }
        .rank-3 .rank-num { color: #d97706; }

        .player-info { flex-grow: 1; display: flex; align-items: center; gap: 15px; }
        .player-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(255,255,255,0.1); }
        .player-name { font-weight: 600; color: white; font-size: 1.1rem; }
        .avatar-frame { position: relative; }
        .avatar-frame img { transition: 0.3s; }
        .frame-neon-blue img { box-shadow: 0 0 10px rgba(34,211,238,0.8); border-color: #22d3ee; }
        .frame-gold-glow img { box-shadow: 0 0 12px rgba(250,204,21,0.8); border-color: #facc15; }
        .frame-cyber-pink img { box-shadow: 0 0 12px rgba(236,72,153,0.8); border-color: #ec4899; }
        
        /* üèÜ Êñ∞Â¢ûÔºöÁ®±ËôüÊ®£Âºè */
        .player-title {
            background: linear-gradient(90deg, #ffd700, #ffb700);
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 10px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            display: inline-block;
            vertical-align: middle;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .score-val { font-family: 'Orbitron'; font-size: 1.2em; color: var(--accent); text-align: right; }
        .date-val { font-size: 0.8em; color: var(--text-muted); width: 80px; text-align: right; margin-left: 15px; }
    </style>
</head>
<body>

    <div class="user-menu">
        <div class="user-profile-btn" style="cursor: default;"> 
            <div class="avatar-display {% if user.equipped_frame %}{{ user.equipped_frame }}{% endif %}">
                {% if user.avatar.startswith('http') %}
                    <img src="{{ user.avatar }}">
                {% elif user.avatar == 'default.png' %}
                    <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=0f172a&color=fff">
                {% else %}
                    <img src="{{ url_for('static', filename='uploads/' + user.avatar) }}">
                {% endif %}
            </div>
            <span class="username-display">{{ user.username }}</span>
        </div>
    </div>

    <h1>üèÜ HALL OF FAME</h1>

    <div class="container glass-panel">
        <div class="tabs">
            <button class="tab-btn active" onclick="loadRank('snake')">Snake</button>
            <button class="tab-btn" onclick="loadRank('dino')">Dino</button>
            <button class="tab-btn" onclick="loadRank('whac')">Whac-A-Ball</button>
            <button class="tab-btn" onclick="loadRank('memory')">Memory</button>
            <button class="tab-btn" onclick="loadRank('tetris')">Tetris</button>
            <button class="tab-btn" onclick="loadRank('shaft')">NS-Shaft</button>
        </div>

        <h3 id="gameTitle" style="text-align:center; color: var(--text-muted); margin-bottom: 20px;">Top Players</h3>
        
        <div id="rankList" class="rank-list">
            <div style="text-align:center; padding: 20px;">Loading...</div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="/lobby" class="btn-secondary" style="border-radius: 50px; padding: 10px 30px;">‚Üê Back to Lobby</a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadRank('snake');
        });

        function loadRank(gameName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            const targetButton = document.querySelector(`.tab-btn[onclick*="'${gameName}'"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }

            const titleMap = { 
                'snake': 'Neon Snake', 
                'dino': 'Dino Run', 
                'whac': 'Whac-A-Ball', 
                'memory': 'Memory Flip',
                'tetris': 'Neon Tetris',
                'shaft': 'NS-Shaft'
            };
            document.getElementById('gameTitle').textContent = titleMap[gameName];

            const list = document.getElementById("rankList");
            list.innerHTML = '<div style="text-align:center; padding: 20px;">Loading data...</div>';

            fetch(`/api/get_rank/${gameName}`)
                .then(res => res.json())
                .then(data => {
                    list.innerHTML = "";
                    if (data.length === 0) {
                        list.innerHTML = '<div style="text-align:center; color: var(--text-muted); padding: 20px;">No records yet. Be the first!</div>';
                        return;
                    }

                    data.forEach((row, index) => {
                        let rankClass = "";
                        if (index === 0) rankClass = "rank-1";
                        if (index === 1) rankClass = "rank-2";
                        if (index === 2) rankClass = "rank-3";

                        const dateStr = row.timestamp ? row.timestamp.substring(5, 10) : '-';
                        
                        let avatarSrc = row.avatar;
                        if (row.avatar === 'default.png') {
                            avatarSrc = `https://ui-avatars.com/api/?name=${row.username}&background=random`;
                        } else if (!row.avatar.startsWith('http')) {
                            avatarSrc = `/static/uploads/${row.avatar}`;
                        }

                        // ‚≠ê ËôïÁêÜÁ®±ËôüÈ°ØÁ§∫
                        let titleHtml = '';
                        if (row.equipped_title) {
                            titleHtml = `<span class="player-title">${row.equipped_title}</span>`;
                        }

                        const frameClass = row.equipped_frame ? row.equipped_frame : '';

                        const item = document.createElement("div");
                        item.className = `rank-item ${rankClass}`;
                        item.innerHTML = `
                            <div class="player-info">
                                <span class="rank-num">#${index + 1}</span>
                                <div class="avatar-frame ${frameClass}">
                                    <img src="${avatarSrc}" class="player-avatar">
                                </div>
                                <div style="display: flex; flex-direction: column; justify-content: center;">
                                    <div>
                                        <span class="player-name">${row.username}</span>
                                        ${titleHtml}
                                    </div>
                                </div>
                            </div>
                            <div style="display:flex; align-items:center;">
                                <span class="score-val">${row.score}</span>
                                <span class="date-val">${dateStr}</span>
                            </div>
                        `;
                        list.appendChild(item);
                    });
                })
                .catch(err => console.error(err));
        }
    </script>
</body>
</html>