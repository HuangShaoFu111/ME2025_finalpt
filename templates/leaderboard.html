<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ’è¡Œæ¦œ - Arcade Hub</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
    <style>
        .container {
            width: 100%;
            max-width: 700px;
            margin-top: 40px;
        }

        /* æ¨™ç±¤åˆ‡æ›æŒ‰éˆ• */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        .tab-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid transparent;
            color: var(--text-muted);
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
        }
        .tab-btn:hover { color: white; background: rgba(255,255,255,0.1); }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
        }

        /* æ’è¡Œæ¦œè¡¨æ ¼ç¾åŒ– */
        .rank-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .rank-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(30, 41, 59, 0.6);
            margin-bottom: 10px;
            padding: 15px 25px;
            border-radius: 12px;
            border-left: 4px solid transparent;
            transition: 0.2s;
        }
        .rank-item:hover {
            transform: scale(1.02);
            background: rgba(30, 41, 59, 0.9);
        }

        /* å‰ä¸‰åç‰¹æ•ˆ */
        .rank-1 { border-left-color: #fbbf24; background: linear-gradient(90deg, rgba(251, 191, 36, 0.1), transparent); }
        .rank-2 { border-left-color: #94a3b8; background: linear-gradient(90deg, rgba(148, 163, 184, 0.1), transparent); }
        .rank-3 { border-left-color: #b45309; background: linear-gradient(90deg, rgba(180, 83, 9, 0.1), transparent); }

        .rank-num { font-family: 'Orbitron'; font-size: 1.2em; width: 40px; font-weight: bold; }
        .rank-1 .rank-num { color: #fbbf24; text-shadow: 0 0 10px #fbbf24; }
        .rank-2 .rank-num { color: #e2e8f0; }
        .rank-3 .rank-num { color: #d97706; }

        .player-info { flex-grow: 1; display: flex; align-items: center; gap: 10px; }
        .player-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 1px solid rgba(255,255,255,0.2); }
        .player-name { font-weight: 600; color: white; }
        
        .score-val { font-family: 'Orbitron'; font-size: 1.1em; color: var(--accent); text-align: right; }
        .date-val { font-size: 0.8em; color: var(--text-muted); width: 80px; text-align: right; margin-left: 15px; }

    </style>
</head>
<body>

    <div class="user-menu">
        <div class="user-profile-btn" style="cursor: default;"> 
            <div class="avatar-display">
                {% if user.avatar == 'default.png' %}
                    <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=0f172a&color=fff" alt="User Avatar">
                {% else %}
                    <img src="{{ url_for('static', filename='uploads/' + user.avatar) }}" alt="User Avatar">
                {% endif %}
            </div>
            <span class="username-display">{{ user.username }}</span>
        </div>
    </div>

    <h1>ğŸ† HALL OF FAME</h1>

    <div class="container glass-panel">
        <div class="tabs">
            <button class="tab-btn active" onclick="loadRank('snake')">Snake</button>
            <button class="tab-btn" onclick="loadRank('dino')">Dino</button>
            <button class="tab-btn" onclick="loadRank('whac')">Whac-A-Ball</button>
            <button class="tab-btn" onclick="loadRank('memory')">Memory</button>
        </div>

        <h3 id="gameTitle" style="text-align:center; color: var(--text-muted); margin-bottom: 20px;">Top Players</h3>
        
        <div id="rankList" class="rank-list">
            <div style="text-align:center; padding: 20px;">Loading...</div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="/lobby" class="btn-secondary" style="border-radius: 50px; padding: 10px 30px;">â† Back to Lobby</a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadRank('snake');
        });

        function loadRank(gameName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            // ä¿®æ­£ JavaScript éŒ¯èª¤ï¼šä¸å†ä¾è³´å…¨åŸŸ event è®Šæ•¸
            const targetButton = document.querySelector(`.tab-btn[onclick*="'${gameName}'"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }

            const titleMap = { 'snake': 'Neon Snake', 'dino': 'Dino Run', 'whac': 'Whac-A-Ball', 'memory': 'Memory Flip' };
            document.getElementById('gameTitle').textContent = titleMap[gameName];

            const list = document.getElementById("rankList");
            list.innerHTML = '<div style="text-align:center; padding: 20px;">Loading data...</div>';

            fetch(`/api/get_rank/${gameName}`)
                .then(res => res.json())
                .then(data => {
                    list.innerHTML = "";
                    if (data.length === 0) {
                        list.innerHTML = '<div style="text-align:center; color: var(--text-muted); padding: 20px;">No records yet. Be the first!</div>';
                        return;
                    }

                    data.forEach((row, index) => {
                        let rankClass = "";
                        if (index === 0) rankClass = "rank-1";
                        if (index === 1) rankClass = "rank-2";
                        if (index === 2) rankClass = "rank-3";

                        const dateStr = row.timestamp ? row.timestamp.substring(5, 10) : '-';
                        // è™•ç†é ­è²¼è·¯å¾‘
                        let avatarSrc = row.avatar === 'default.png' 
                            ? `https://ui-avatars.com/api/?name=${row.username}&background=random`
                            : `/static/uploads/${row.avatar}`;

                        const item = document.createElement("div");
                        item.className = `rank-item ${rankClass}`;
                        item.innerHTML = `
                            <div class="player-info">
                                <span class="rank-num">#${index + 1}</span>
                                <img src="${avatarSrc}" class="player-avatar">
                                <span class="player-name">${row.username}</span>
                            </div>
                            <div style="display:flex; align-items:center;">
                                <span class="score-val">${row.score}</span>
                                <span class="date-val">${dateStr}</span>
                            </div>
                        `;
                        list.appendChild(item);
                    });
                })
                .catch(err => console.error(err));
        }
    </script>
</body>
</html>